# Чек-лист подготовки к продакшн

## Требования к окружению

- [ ] Установите переменные окружения:
  - [ ] `TELEGRAM_BOT_TOKEN` - токен Telegram бота для авторизации и уведомлений
  - [ ] `JWT_SECRET` - секретный ключ для подписи JWT (минимум 32 символа)
  - [ ] `ENCRYPTION_KEY` - ключ шифрования для чувствительных данных (ровно 32 символа)
  - [ ] `DATABASE_URL` - URL подключения к PostgreSQL базе данных
  - [ ] `NEXT_PUBLIC_SOCKET_URL` - URL для WebSocket соединений (в продакшене обычно основной домен)

## База данных

- [ ] Выполните миграцию схемы базы данных: `npx prisma migrate deploy`
- [ ] Создайте индексы для оптимизации запросов: `npx prisma db execute --file ./scripts/create-indexes.sql`
- [ ] Настройте резервное копирование базы данных

## Сервер WebSocket

- [ ] Выберите способ запуска WebSocket сервера:
  - [ ] Для Vercel: используйте NextJS API Routes с `/api/socket/route.ts`
  - [ ] Для выделенного сервера: запустите `server/index.ts` с PM2 или аналогичным менеджером процессов

## Безопасность

- [ ] Включите HTTPS
- [ ] Настройте заголовки безопасности (уже добавлены в middleware.ts)
- [ ] Настройте ограничения запросов (rate limiting)
- [ ] Проверьте отсутствие секретов в исходном коде
- [ ] Убедитесь, что бэкапы зашифрованы

## Мониторинг и логирование

- [ ] Настройте мониторинг доступности сервиса
- [ ] Настройте алерты при критических ошибках
- [ ] Настройте логирование запросов и ошибок
- [ ] Настройте мониторинг производительности

## Масштабирование

- [ ] Для высоких нагрузок рассмотрите:
  - [ ] Выделенные серверы для WebSocket
  - [ ] Кэширование с использованием Redis
  - [ ] Горизонтальное масштабирование с балансировкой нагрузки

## Тестирование перед запуском

- [ ] Выполните нагрузочное тестирование
- [ ] Протестируйте восстановление после сбоев
- [ ] Проверьте работу всех критических функций:
  - [ ] Авторизация через Telegram
  - [ ] Создание и присоединение к столам
  - [ ] Игровые механики
  - [ ] Депозиты и выводы TON
  - [ ] GDPR функции (экспорт/удаление данных)

## TON интеграция

- [ ] Для реального запуска замените симуляцию TON на настоящую интеграцию:
  - [ ] Создайте мастер-кошелек для хранения TON пользователей
  - [ ] Настройте мониторинг блокчейна для отслеживания депозитов
  - [ ] Настройте безопасную подпись транзакций для выводов
  - [ ] Настройте проверку баланса для обеспечения покрытия всех обязательств

